{% extends "AppBundle::layout.html.twig" %}

{% block title %}
    Panneau d'administration - {{ parent() }}
{% endblock %}

{% block body %}

    {%  if (app.user.roles is defined) and ('ROLE_ADMIN' in app.user.roles) %}
        <a href="{{ path('dashboard_admin') }}" class="btn btn-primary return-to-dashboard">{{ 'dashboard.employer.return' | trans }}</a>
    {% endif %}
    <div class="col-md-1 select-year">
        <select id="log-year" class="col-md-1 col-md-offset-3 form-control">
            <option value="2018" {% if year == '2018' %}selected{% endif %}>2018</option>
            <option value="2019" {% if year == '2019' %}selected{% endif %}>2019</option>
        </select>
    </div>
    <div class="container jobnow-container" style="text-align: center">

        <div class="navbar-dashboard">
            <ul class="nav nav-tabs nav-candidate navbar-dashboard">
                <li class="active">
                    <a class="tab-log" data-target="#applied" data-toggle="tab" data-id="offer">{{ 'dashboard.employer.slot.offer'|trans }}</a>
                </li>
                <li><a class="tab-log" data-target="#application" data-toggle="tab" data-id="application">Application</a>
                </li>
                <li><a class="tab-log" data-target="#alerts" data-toggle="tab" data-id="employer">{{ 'notification.employer'|trans }}</a>
                </li>
                <li><a class="tab-log" data-target="#favorites" data-toggle="tab" data-id="candidate">{{ 'header.candidates.register'|trans }}</a>
                </li>
                <li><a class="tab-log" data-target="#credit" data-toggle="tab" data-id="credit">{{ 'price.credit'|trans }}</a>
                </li>
            </ul>
        </div>
        <div class="container jobnow-container">
            <div class="tab-content candidate-content">
                <div class="tab-pane active fade in" id="applied">
                    <div class="shadow-box">
                        <h2>{{ 'admin.log.nbrActive'|trans }}</h2>
                        <div class="ct-chart ct-offer ct-perfect-fourth" style="height: 500px;"></div>
                        <div class="point-value"></div>
                    </div>

                </div>
                <div class="tab-pane active fade" id="alerts">
                    <div class="shadow-box">
                        <h2>{{ 'admin.log.nbrEmployer'|trans }}</h2>
                        <div class="ct-chart ct-employer ct-perfect-fourth" style="height: 500px;"></div>
                        <div class="point-value"></div>
                    </div>
                </div>
                <div class="tab-pane fade" id="favorites">
                    <div class="shadow-box">
                        <h2>{{ 'admin.log.nbrCandidate'|trans }}</h2>
                        <div class="ct-chart ct-candidate ct-perfect-fourth" style="height: 500px;"></div>
                        <div class="point-value"></div>
                    </div>
                </div>
                <div class="tab-pane fade" id="credit">
                    <div class="shadow-box">
                        <div class="tab-content candidate-content">
                            <div class="navbar-dashboard">
                                <ul class="nav nav-tabs nav-candidate navbar-dashboard">
                                    <li class="active">
                                        <a class="tab-log" data-target="#total" data-toggle="tab" data-id="total">{{ 'admin.log.total'|trans }}</a>
                                    </li>
                                    <li><a class="tab-log" data-target="#monthly" data-toggle="tab" data-id="monthly">{{ 'admin.log.monthly'|trans }}</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="tab-pane active initial fade" id="total">
                                <div class="shadow-box">
                                    <h2>{{ 'admin.log.totalCredit'|trans }}</h2>
                                    <div class="ct-chart ct-credit ct-perfect-fourth" style="height: 500px;"></div>
                                    <div class="point-value"></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="monthly">
                                <div class="shadow-box">
                                    <h2>{{ 'admin.log.monthlyCredit'|trans }}</h2>
                                    <div class="ct-chart ct-credit-monthly ct-perfect-fourth" style="height: 500px;"></div>
                                    <div class="point-value"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="application">
                    <div class="shadow-box">
                        <div class="tab-content candidate-content">
                            <div class="navbar-dashboard">
                                <ul class="nav nav-tabs nav-candidate navbar-dashboard">
                                    <li class="active">
                                        <a class="tab-log" data-target="#total-application" data-toggle="tab" data-id="total-application">{{ 'admin.log.total'|trans }}</a>
                                    </li>
                                    <li><a class="tab-log" data-target="#monthly-application" data-toggle="tab" data-id="monthly-application">{{ 'admin.log.monthly'|trans }}</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="tab-pane active initial fade" id="total-application">
                                <div class="shadow-box">
                                    <h2>Total application</h2>
                                    <div class="ct-chart ct-application ct-perfect-fourth" style="height: 500px;"></div>
                                    <div class="point-value"></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="monthly-application">
                                <div class="shadow-box">
                                    <h2>Nombre d'application par mois</h2>
                                    <div class="ct-chart ct-application-monthly ct-perfect-fourth" style="height: 500px;"></div>
                                    <div class="point-value"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script>
        var options = {
            // Don't draw the line chart points
            showPoint: true,
            // Disable line smoothing
            lineSmooth: false,
            // X-Axis specific configuration
            axisY: {
                onlyInteger: true
            },
        };

        var data = {
            // A labels array that can contain any sort of values
            labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
            // Our series array that contains series objects or in this case series data arrays
            series: [
                {{ activeOfferLog |json_encode|raw}}
            ]
        };

        // Create a new line chart object where as first parameter we pass in a selector
        // that is resolving to our chart container element. The Second parameter
        // is the actual data object.
        let chart = new Chartist.Line('.ct-offer', data, options);
        let addedEvents = false;
        chart.on('draw', function() {
            if (!addedEvents) {
                $('.ct-point').on('mouseover', function() {
                    $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                });
            }
        });
        $('.tab-log').on("click", function(e){
            $('.point-value').html('');
            switch ($(this).data('id')) {
                case 'offer':
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ activeOfferLog |json_encode|raw}}
                        ]
                    };
                        let chart = new Chartist.Line('.ct-offer', data, options);
                        let addedEvents = false;
                        chart.on('draw', function() {
                            if (!addedEvents) {
                                $('.ct-point').on('mouseover', function() {
                                    $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                                });
                            }
                        });}, 500);
                    break;
                case 'employer':
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ activeEmployerLog |json_encode|raw}}
                        ]
                    };
                        let chart = new Chartist.Line('.ct-employer', data, options);
                        let addedEvents = false;
                        chart.on('draw', function() {
                            if (!addedEvents) {
                                $('.ct-point').on('mouseover', function() {
                                    $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                                });
                            }
                        });
                        }, 500);
                    break;
                case 'candidate':
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ activeCandidateLog |json_encode|raw}}
                        ]
                    };
                        let chart = new Chartist.Line('.ct-candidate', data, options);
                        let addedEvents = false;
                        chart.on('draw', function() {
                            if (!addedEvents) {
                                $('.ct-point').on('mouseover', function() {
                                    $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                                });
                            }
                        });
                    }, 500);
                    break;
                case 'credit':
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ creditLog |json_encode|raw}}
                        ]
                    };
                    let chart = new Chartist.Line('.ct-credit', data, options);
                    let addedEvents = false;
                    chart.on('draw', function() {
                        if (!addedEvents) {
                            $('.ct-point').on('mouseover', function() {
                                $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                            });
                        }
                    });
                    }, 500);
                    break;
                case 'monthly':
                    $('#total').removeClass('initial');
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ monthlyCreditLog |json_encode|raw}}
                        ]
                    };
                        let chart = new Chartist.Line('.ct-credit-monthly', data, options);
                        let addedEvents = false;
                        chart.on('draw', function() {
                            if (!addedEvents) {
                                $('.ct-point').on('mouseover', function() {
                                    $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                                });
                            }
                        });
                    }, 500);
                    break;
                case 'application':
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ application |json_encode|raw}}
                        ]
                    };
                    let chart = new Chartist.Line('.ct-application', data, options);
                    let addedEvents = false;
                    chart.on('draw', function() {
                        if (!addedEvents) {
                            $('.ct-point').on('mouseover', function() {
                                $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                            });
                        }
                    });
                    }, 500);
                    break;
                case 'monthly-application':
                    $('#total-application').removeClass('initial');
                    setTimeout(function(){  var data = {
                        labels: ['1', '2', '3', '4', '5','6', '7', '8', '9', '10', '11', '12'],
                        series: [
                            {{ monthlyApplication |json_encode|raw}}
                        ]
                    };
                        let chart = new Chartist.Line('.ct-application-monthly', data, options);
                        let addedEvents = false;
                        chart.on('draw', function() {
                            if (!addedEvents) {
                                $('.ct-point').on('mouseover', function() {
                                    $('.point-value').html('<b>{{'admin.log.selected'|trans }}: </b>' + $(this).attr('ct:value'));
                                });
                            }
                        });
                    }, 500);
                    break;
            }

        });
        $('.ct-point').on('mouseover', function(e){
            console.log('rr');
            $('.point-value').html($(this).val());
        });

        $("#log-year").change(function() {
            let year = $(this).val();
            switch(year){
                case '2018':
                    window.location.replace('{{ path('log_page', {'year': 2018}) }}');
                    break;
                case '2019':
                    window.location.replace('{{ path('log_page', {'year': 2019}) }}');
                    break;
            }
        });
    </script>
    <style>
        .ct-label{
            color: black;
            font-size: 14px;
        }
        .initial{
            display: initial !important;
        }
    </style>
{% endblock %}