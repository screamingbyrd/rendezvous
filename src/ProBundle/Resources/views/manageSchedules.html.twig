
{% extends "AppBundle::layout.html.twig" %}

{% block title %}
    {{ parent() }} - {{ 'footer.faq'|trans }}
{% endblock %}

{% block body %}


    <div class="container rendezvous-container">
        <script>
            $(document).ready(() => {
                var date = new Date();
                var d = date.getDate();
                var m = date.getMonth();
                var y = date.getFullYear();

                $('#calendar').fullCalendar({
                    header: {
                        left: 'prev, next',
                        center: 'title',
                        right: 'agendaWeek, agendaDay'
                    },
                    timezone: ('Europe/London'),
                    allDaySlot: false,
                    defaultView: 'agendaWeek',
                    lazyFetching: true,
                    firstDay: 1,
                    selectable: true,
                    editable: true,
                    locale: '{{ app.request.locale }}',
                    eventDurationEditable: true,
                    events: {{ schedules|json_encode()|raw }},
                    eventRender: function(event, element) {
                        element.attr('title', event.tip);
                        element.prepend( "<span class='removebtn'>X</span>" );
                        element.find(".removebtn").click(function() {
                            var url = "{{ path('remove_schedule') }}";
                            $.ajax({
                                url: url,
                                data: {id:event.id}
                            });
                            $('#calendar').fullCalendar('removeEvents',event._id);
                        });
                    },
                    select: function(start, end, jsEvent, view) {
                        var newEvent = new Object();
                        newEvent.title = 'Dur√©e du travail';
                        newEvent.start = start;
                        newEvent.end = end;
                        start=start.format('Y-MM-DD HH:mm:ss');
                        end=end.format('Y-MM-DD HH:mm:ss');
                        url = "{{ path('save_schedule') }}";
                        $.ajax({
                            url: url,
                            data: {userId:{{ app.user.id }},startDate:start, endDate:end}
                        }).done(function( data ) {
                            newEvent.id = data;
                        });

                        $('#calendar').fullCalendar('renderEvent', newEvent);

                    },
                    eventDrop: function(event, delta, revertFunc) {
                        var start = event.start.format('Y-MM-DD HH:mm:ss');
                        var end = event.end.format('Y-MM-DD HH:mm:ss');
                        var url = "{{ path('save_schedule') }}";
                        $.ajax({
                            url: url,
                            data: {id:event.id,startDate:start, endDate:end}
                        });
                    },
                    eventResize: function(event, delta, revertFunc) {
                        var start = event.start.format('Y-MM-DD HH:mm:ss');
                        var end = event.end.format('Y-MM-DD HH:mm:ss');
                        var url = "{{ path('save_schedule') }}";
                        $.ajax({
                            url: url,
                            data: {id:event.id,startDate:start, endDate:end}
                        });
                    }
                })
            })
            $(document).on("click", ".removebtn", function(event) {
                console.log("click", event);
            })

        </script>
        <div id='calendar'></div>
    </div>



    <style>
        .fc-event .fc-bg {
            display: none !important;
        }
        .removebtn {
            color:black;
            position: absolute;
            top: 0;
            right: 0;
            width:13px;
            height: 13px;
            text-align:center;
            border-radius:50%;
            font-size: 10px;
            cursor: pointer;
            background-color: #FFF;
            z-index: 1000;
        }
    </style>

{% endblock %}